ER, Tue Nov  8 09:01:51 EST 2016
Instructions for installing rscape and R-scape-web on eddylab.org
==================================================================================================

1. scp your rscape tarball to archangel, ssh there, and install it.
  (The current one is installed in my home directory, but you can put it anywhere.
   We will configure a directory variable in R-scape-web appropriately,
   so the web server knows where to find it. My instructions here will
   put the new one in your home dir.)

  scp rscape_v0.2.2.tar.gz erivas@archangel.eddylab.org
  ssh erivas@archangel.eddylab.org
  # now on remote eddylab.org host...
  tar zxf rscape_v0.2.2.tar.gz
  cd rscape_v0.2.2
  ./configure; make; make install

  # R-scape is now installed in your ${HOME}/rscape-v0.2.2/bin

2. It's convenient to set a symlink `rscape` to point at the current
  version. Then you can install a new rscape version at any time, and
  just move the symlink when you're ready, and you don't have to
  update anything else.
  (Compare how I have various rscape versions in ~seddy on archangel.)

  ln -s rscape_v0.2.2 rscape

3. Back on your local machine (not archangel): 
  clone the R-scape-web code from github, cd into that dir
  (Below I'll explain there's an easier way, if you only want
  to update the rscape version; but if you get the R-scape-web
  server code, you'll be able to update anything else on the site
  too)

  git clone https://github.com/EddyRivasLab/R-scape-web R-scape-web
  cd R-scape-web

4. Create a Makefile in that directory that contains the stuff between
  the ---snip----'s:

------ snip --------
# This Makefile is deliberately NOT under git control.
# It contains information about our remote install paths.
# We don't want that info on the public github.

WEBHOST = erivas@archangel.eddylab.org
WEBDIR  = /var/www/eddylab.org/public_html/R-scape

# 'make all' updates the remote site at eddylab.org
# You still need to restart the starman-rscape service:
#    ssh erivas@archangel.eddylab.org
#    sudo service restart starman-rscape
#
all:
	rsync -rlvz --exclude '*~' R-scape/ ${WEBHOST}:${WEBDIR}/

------ snip --------


5. Edit the configuration file that sets where the R-scape code is.

   cd R-scape
   emacs rscape.conf

  Change `rscape_dir` from /home/seddy/rscape to wherever
  you have rscape installed on archangel (/home/erivas/rscape, if
  you followed the instructions above, including making the symlink)


6. Push the updated R-scape-web code to archangel:

   make


7. Now you have to restart the webserver on archangel

   ssh erivas@archangel.eddylab.org
   sudo service restart starman-rscape


In the future, to update rscape code, you only have to follow instructions (1) and (2). The web server will always be looking for /home/erivas/rscape, so by changing that symlink, that's all you have to do; the web server itself doesn't need any updating (the only reason we did it here is to change the path from /home/seddy/rscape to /home/erivas/rscape).

In fact, you don't really have to do steps (3)-(6) at all; you don't need to be able to push new R-scape-web code to update the rscape binary. All you have to do is change where the web server is looking for that binary. You could:

  ssh erivas@archangel.eddylab.org
  cd /var/www/eddylab.org/public_html/R-scape
  emacs rscape.conf
  # edit the `rscape_dir` variable, as above, to /home/erivas/rscape
  sudo service restart starman-rscape

but if you have the R-scape-web git repo checked out and you know how to push changes to eddylab.org, you can change other things on the site yourself, not just update the rscape binary.


